apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: issue-open
  labels:
    app: thoth-ci
spec:
  params:
    - name: pr_number
      type: string
    - name: event_action
      type: string
  resources:
    inputs:
      - name: pr
        type: pullRequest
      - name: s2i-thoth
        type: image
    outputs:
      - name: pr
        type: pullRequest
  steps:
    - name: items-check
      image: quay.io/thoth-station/s2i-thoth-ubi8-py36:latest # use $(resources.inputs.s2i-thoth.url) in ocp4.x
      script: |
        ls -al

    - name: pr-items-check
      image: quay.io/thoth-station/s2i-thoth-ubi8-py36:latest # use $(resources.inputs.s2i-thoth.url) in ocp4.x
      workingDir: /workspace/pr
      script: |
        ls -al

    - name: open-pr
      image: quay.io/thoth-station/s2i-thoth-ubi8-py36:latest # use $(resources.inputs.s2i-thoth.url) in ocp4.x
      workingDir: /workspace/repo
      securityContext:
        privileged: true
      script: |
        echo $(params.event_action)
        cp -r /workspace/pr/ /workspace/output/
        if [ "$(params.event_action)" == "opened" ] || [ "$(params.event_action)" == "reopened" ]; then
          echo "Thanks for Opening the Pull Request" > /workspace/output/pr/comments/open
        fi
